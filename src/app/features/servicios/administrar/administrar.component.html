<div class="admin-container">
  <!-- Hero Section -->
  <section class="hero-section">
    <div class="hero-content">
      <h1 class="hero-title">Gestionar Servicios</h1>
      <p class="hero-subtitle">Administra los servicios que ofrece tu barbería</p>
    </div>
  </section>

  <!-- Admin Section -->
  <section class="admin-section">
    <div class="container">
      <!-- Barbería Selection -->
      <div class="admin-header">
        <label class="form-label" style="display: block; margin-bottom: 0.5rem;">Selecciona una Barbería <span class="required">*</span></label>
        <select class="filter-select" [(ngModel)]="barberiaSeleccionada" (change)="onBarberiaChange()">
          <option [value]="null">-- Selecciona una barbería --</option>
          <option *ngFor="let barberia of barberias" [value]="barberia.idBarberia">
            {{ barberia.nombre }} ({{ barberia.ciudad }})
          </option>
        </select>
      </div>

      <!-- Form Section -->
      <section class="form-section" *ngIf="barberiaSeleccionada && mostrarFormulario">
        <div class="form-container">
          <div class="form-header">
            <h2 class="form-title">{{ editandoId ? 'Editar Servicio' : 'Crear Nuevo Servicio' }}</h2>
          </div>
          <form [formGroup]="formulario" class="form-content">
            <div class="form-row">
              <div class="form-group">
                <label class="form-label">Nombre <span class="required">*</span></label>
                <input type="text" class="form-input" formControlName="nombre" placeholder="Ej: Corte de cabello">
                <div class="error-message" *ngIf="campoNombre?.invalid && campoNombre?.touched">
                  El nombre es requerido y debe tener al menos 3 caracteres
                </div>
              </div>
              <div class="form-group">
                <label class="form-label">Categoría <span class="required">*</span></label>
                <select class="form-input" formControlName="categoria">
                  <option value="">-- Selecciona una categoría --</option>
                  <option *ngFor="let cat of categorias" [value]="cat">{{ cat }}</option>
                </select>
                <div class="error-message" *ngIf="campoCategoria?.invalid && campoCategoria?.touched">
                  La categoría es requerida
                </div>
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label class="form-label">Precio (S/) <span class="required">*</span></label>
                <input type="number" class="form-input" formControlName="precio" placeholder="0.00" step="0.01" min="0">
                <div class="error-message" *ngIf="campoPrecio?.invalid && campoPrecio?.touched">
                  El precio es requerido y debe ser mayor a 0
                </div>
              </div>
              <div class="form-group">
                <label class="form-label">Duración (minutos) <span class="required">*</span></label>
                <input type="number" class="form-input" formControlName="duracion" placeholder="30" min="1">
                <div class="error-message" *ngIf="campoDuracion?.invalid && campoDuracion?.touched">
                  La duración es requerida y debe ser mayor a 0
                </div>
              </div>
            </div>
            <div class="form-row">
              <div class="form-group full-width">
                <label class="form-label">Descripción</label>
                <textarea class="form-input" formControlName="descripcion" rows="3" placeholder="Describe el servicio..."></textarea>
              </div>
            </div>
            <div class="form-row">
              <div class="form-group checkbox">
                <input type="checkbox" id="destacado" class="form-checkbox" formControlName="destacado">
                <label class="checkbox-label" for="destacado">Marcar como servicio destacado</label>
              </div>
              <div class="form-group checkbox">
                <input type="checkbox" id="activo" class="form-checkbox" formControlName="activo">
                <label class="checkbox-label" for="activo">Servicio activo</label>
              </div>
            </div>
            <div class="form-actions">
              <button type="button" class="btn btn-primary" (click)="guardarServicio()" [disabled]="cargando">
                {{ editandoId ? 'Actualizar' : 'Crear' }}
              </button>
              <button type="button" class="btn btn-secondary" (click)="cancelarEdicion()">
                Cancelar
              </button>
            </div>
          </form>
        </div>
      </section>

      <!-- Header with New Button -->
      <div class="admin-header" *ngIf="barberiaSeleccionada && !mostrarFormulario">
        <button class="btn btn-add" (click)="toggleFormulario()">
          <span>➕</span> Nuevo Servicio
        </button>
      </div>

      <!-- Search Section -->
      <div class="search-section" *ngIf="barberiaSeleccionada && !mostrarFormulario">
        <div class="search-box">
          <svg class="search-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
          </svg>
          <input type="text" class="search-input" placeholder="Buscar por nombre o descripción..."
                 [(ngModel)]="busqueda" (keyup)="aplicarFiltros()">
        </div>
        <select class="filter-select" [(ngModel)]="filtroCategoria" (change)="aplicarFiltros()">
          <option value="">Todas las categorías</option>
          <option *ngFor="let cat of categorias" [value]="cat">{{ cat }}</option>
        </select>
      </div>

      <!-- Loading State -->
      <div class="loading-state" *ngIf="cargando">
        <div class="spinner"></div>
        <p>Cargando servicios...</p>
      </div>

      <!-- Items Grid -->
      <div class="items-grid" *ngIf="barberiaSeleccionada && !cargando && serviciosFiltrados.length > 0">
        <div class="item-card" *ngFor="let servicio of serviciosFiltrados">
          <div class="card-header">
            <h3 class="card-title">
              {{ servicio.nombre }}
              <span style="font-size: 0.8em; margin-left: 0.5rem;" *ngIf="servicio.destacado">⭐</span>
            </h3>
            <span class="status-badge" [ngClass]="servicio.activo ? 'status-activa' : 'status-inactiva'">
              {{ servicio.activo ? 'Activo' : 'Inactivo' }}
            </span>
          </div>
          <div class="card-body">
            <div class="card-detail">
              <span class="detail-label">Categoría:</span>
              <span class="detail-value">{{ servicio.categoria }}</span>
            </div>
            <div class="card-detail">
              <span class="detail-label">Precio:</span>
              <span class="detail-value">S/ {{ servicio.precio | number: '1.2-2' }}</span>
            </div>
            <div class="card-detail">
              <span class="detail-label">Duración:</span>
              <span class="detail-value">{{ servicio.duracionMinutos || servicio.duracion }} min</span>
            </div>
            <div class="card-detail" *ngIf="servicio.descripcion">
              <span class="detail-label">Descripción:</span>
              <span class="detail-value">{{ servicio.descripcion | slice:0:50 }}...</span>
            </div>
          </div>
          <div class="card-actions">
            <button class="action-btn action-edit" (click)="editarServicio(servicio)" title="Editar">
              ✎ Editar
            </button>
            <button class="action-btn action-status" (click)="toggleDestacado(servicio)" title="Cambiar destacado">
              {{ servicio.destacado ? '☆ Quitar' : '⭐ Destacar' }}
            </button>
          </div>
        </div>
      </div>

      <!-- No Results -->
      <div class="no-results" *ngIf="barberiaSeleccionada && !cargando && serviciosFiltrados.length === 0">
        <svg class="no-results-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H5a2 2 0 00-2 2v9a2 2 0 002 2h5M16 6h5a2 2 0 012 2v9a2 2 0 01-2 2h-5m-6-11L11 8m0 0l4 4m-4-4v8"></path>
        </svg>
        <h3>No hay servicios configurados</h3>
        <p>Crea los servicios que ofrece tu barbería</p>
      </div>

      <!-- Select Barbería Message -->
      <div class="no-results" *ngIf="!barberiaSeleccionada && !cargando">
        <svg class="no-results-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
        <h3>Selecciona una barbería</h3>
        <p>Para gestionar servicios, debes seleccionar una barbería primero</p>
      </div>
    </div>
  </section>
</div>