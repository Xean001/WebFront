<div class="comprobante-container">
  <!-- Header -->
  <div class="comprobante-header">
    <h1>Cargar Comprobante de Pago</h1>
    <p>Realiza el pago y sube el comprobante para activar tu suscripci√≥n</p>
  </div>

  <!-- Success Screen -->
  <div *ngIf="comprobanteExitoso" class="success-screen">
    <div class="success-icon">‚úì</div>
    <h2>¬°Comprobante Enviado!</h2>
    <p>Tu comprobante ha sido recibido correctamente.</p>
    <p class="status-info">Estado: <strong>PENDIENTE DE APROBACI√ìN</strong></p>
    <p class="redirect-message">El administrador revisar√° tu pago en breve.</p>
    <p class="redirect-submessage">Redirigiendo al login...</p>
  </div>

  <!-- Payment Form -->
  <div *ngIf="!comprobanteExitoso" class="comprobante-form-container">
    <!-- Informaci√≥n de la Suscripci√≥n -->
    <div class="info-suscripcion">
      <div class="info-item">
        <span class="label">Monto a Pagar:</span>
        <span class="valor">${{ monto | number: '1.2-2' }}</span>
      </div>
      <div class="info-item">
        <span class="label">Plan:</span>
        <span class="valor">{{ tipoPlan }}</span>
      </div>
      <div class="info-item">
        <span class="label">ID Suscripci√≥n:</span>
        <span class="valor">{{ idSuscripcion }}</span>
      </div>
    </div>

    <!-- Payment Methods -->
    <div class="metodos-pago">
      <h3>Selecciona M√©todo de Pago</h3>
      <div class="metodo-selector">
        <button 
          type="button"
          class="metodo-btn"
          [class.active]="metodoPagoSeleccionado === 'YAPE'"
          (click)="cambiarMetodoPago('YAPE')"
        >
          üì± Yape
        </button>
        <button 
          type="button"
          class="metodo-btn"
          [class.active]="metodoPagoSeleccionado === 'PLIN'"
          (click)="cambiarMetodoPago('PLIN')"
        >
          üì≤ Plin
        </button>
      </div>
    </div>

    <!-- Instrucciones de Pago -->
    <div *ngIf="datosParaPagar" class="instrucciones-pago">
      <h3>Instrucciones de Pago - {{ metodoPagoSeleccionado }}</h3>
      
      <!-- C√≥digo QR -->
      <div class="qr-container">
        <div class="qr-image">
          <img 
            *ngIf="metodoPagoSeleccionado === 'YAPE'" 
            src="/images/qr-yape.jpg" 
            alt="C√≥digo QR Yape"
            (error)="onQRError($event)"
          >
          <img 
            *ngIf="metodoPagoSeleccionado === 'PLIN'" 
            src="/images/qr-plin.jpg" 
            alt="C√≥digo QR Plin"
            (error)="onQRError($event)"
          >
        </div>
        <p class="qr-instruccion">Escanea este c√≥digo QR con tu app de {{ metodoPagoSeleccionado }}</p>
        <p class="qr-monto">Monto: <strong>${{ monto | number: '1.2-2' }}</strong></p>
      </div>
      
      <!-- Datos de Pago -->
      <div class="datos-pago">
        <div *ngIf="datosParaPagar.numeroCuenta" class="dato-item">
          <label>N√∫mero de Cuenta:</label>
          <div class="dato-valor">
            <span>{{ datosParaPagar.numeroCuenta }}</span>
            <button 
              type="button" 
              class="btn-copy"
              (click)="copiarAlPortapapeles(datosParaPagar.numeroCuenta, 'N√∫mero de Cuenta')"
            >
              üìã Copiar
            </button>
          </div>
        </div>

        <div *ngIf="datosParaPagar.nombreBeneficiario" class="dato-item">
          <label>Beneficiario:</label>
          <div class="dato-valor">
            <span>{{ datosParaPagar.nombreBeneficiario }}</span>
          </div>
        </div>

        <div *ngIf="datosParaPagar.banco" class="dato-item">
          <label>Banco:</label>
          <div class="dato-valor">
            <span>{{ datosParaPagar.banco }}</span>
          </div>
        </div>

        <div *ngIf="datosParaPagar.codigoInterbancario" class="dato-item">
          <label>C√≥digo Interbancario:</label>
          <div class="dato-valor">
            <span>{{ datosParaPagar.codigoInterbancario }}</span>
            <button 
              type="button" 
              class="btn-copy"
              (click)="copiarAlPortapapeles(datosParaPagar.codigoInterbancario, 'C√≥digo Interbancario')"
            >
              üìã Copiar
            </button>
          </div>
        </div>

        <div *ngIf="datosParaPagar.descripcion" class="dato-item">
          <label>Concepto/Referencia:</label>
          <div class="dato-valor">
            <span>{{ datosParaPagar.descripcion }}</span>
            <button 
              type="button" 
              class="btn-copy"
              (click)="copiarAlPortapapeles(datosParaPagar.descripcion, 'Referencia')"
            >
              üìã Copiar
            </button>
          </div>
        </div>

        <div *ngIf="datosParaPagar.qr" class="dato-item">
          <label>C√≥digo QR:</label>
          <img [src]="datosParaPagar.qr" alt="QR para pago" class="qr-code">
        </div>
      </div>

      <!-- Pasos de Pago -->
      <div class="pasos-pago">
        <h4>Pasos para Pagar:</h4>
        <ol>
          <li>Abre tu app de {{ metodoPagoSeleccionado }} o tu banco</li>
          <li>Selecciona "Enviar Dinero" o "Nueva Transferencia"</li>
          <li>Copia los datos de arriba (n√∫mero de cuenta, monto, referencia)</li>
          <li>Completa el pago por {{ monto | number: '1.2-2' }}</li>
          <li>Guarda la captura de pantalla del comprobante</li>
          <li>Regresa aqu√≠ y completa el formulario de abajo</li>
        </ol>
      </div>

      <div class="monto-recordatorio">
        <strong>üìå Recuerda:</strong> Debes transferir exactamente <strong>${{ monto | number: '1.2-2' }}</strong>
      </div>
    </div>

    <!-- Formulario de Comprobante -->
    <form [formGroup]="formulario" (ngSubmit)="registrarComprobante()" class="comprobante-form">
      <h3>Datos del Comprobante</h3>

      <div class="form-group">
        <label for="numeroOperacion">N√∫mero de Operaci√≥n:</label>
        <input 
          id="numeroOperacion" 
          type="text" 
          formControlName="numeroOperacion" 
          placeholder="Ej: 00123456"
        >
        <div *ngIf="formulario.get('numeroOperacion')?.invalid && formulario.get('numeroOperacion')?.touched" class="error-message">
          <span *ngIf="formulario.get('numeroOperacion')?.errors?.['required']">N√∫mero de operaci√≥n requerido.</span>
          <span *ngIf="formulario.get('numeroOperacion')?.errors?.['minlength']">M√≠nimo 6 caracteres.</span>
        </div>
      </div>

      <div class="form-group">
        <label for="comprobante">Imagen del Comprobante (JPG o PNG):</label>
        <div class="file-input-wrapper">
          <input 
            id="comprobante" 
            type="file" 
            formControlName="comprobante"
            accept="image/jpeg,image/png"
            (change)="onArchivoSeleccionado($event)"
            class="file-input"
          >
          <label for="comprobante" class="file-input-label">
            <span class="file-input-icon">üì∏</span>
            <span class="file-input-text">
              {{ archivoSeleccionado ? '‚úì ' + archivoSeleccionado.name : 'Selecciona imagen (JPG, PNG)' }}
            </span>
          </label>
        </div>
        <small>M√°ximo 5MB. Acepta JPG y PNG.</small>
        
        <!-- Error de archivo -->
        <div *ngIf="errores['comprobante']" class="error-message">
          ‚ö†Ô∏è {{ errores['comprobante'] }}
        </div>

        <!-- Previsualizaci√≥n de imagen -->
        <div *ngIf="previsualizacionComprobante" class="imagen-preview-container">
          <h4>Previsualizaci√≥n:</h4>
          <img [src]="previsualizacionComprobante" alt="Previsualizaci√≥n del comprobante" class="imagen-preview">
          <p class="preview-info">
            <strong>Archivo:</strong> {{ archivoSeleccionado?.name }}<br>
            <strong>Tama√±o:</strong> {{ (archivoSeleccionado?.size || 0) | number }} bytes
          </p>
        </div>
      </div>

      <div *ngIf="errores['general']" class="alert-error">
        <div style="white-space: pre-line;">{{ errores['general'] }}</div>
      </div>

      <div class="button-group">
        <button type="button" (click)="irAlRegistro()" class="btn-secondary">
          ‚Üê Volver
        </button>
        <button type="submit" [disabled]="cargando || formulario.invalid || !comprobanteBase64" class="btn-primary">
          <span *ngIf="!cargando">üì§ Enviar Comprobante</span>
          <span *ngIf="cargando">Procesando...</span>
        </button>
      </div>
    </form>
  </div>

  <!-- Security Info -->
  <div class="security-info">
    üîí Tu informaci√≥n est√° protegida y ser√° revisada por nuestro administrador
  </div>
</div>
