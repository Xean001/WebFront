<div class="barberos-container">
  <!-- Header con bot√≥n para agregar -->
  <div class="header">
    <h2>Personal de la Barber√≠a</h2>
    <button class="btn btn-primary" (click)="toggleFormularioCrear()" *ngIf="!mostrarFormularioCrear">
      ‚ûï Agregar Barbero
    </button>
  </div>

  <!-- Formulario Crear Barbero -->
  <div class="create-form-card" *ngIf="mostrarFormularioCrear">
    <h3>Crear Nuevo Barbero</h3>
    <form [formGroup]="formularioCrear" (ngSubmit)="crearBarbero()">
      <div class="form-row">
        <div class="form-group">
          <label>Nombre <span class="required">*</span></label>
          <input type="text" formControlName="nombre" placeholder="Nombre del barbero" class="form-input">
          <div class="error-message" *ngIf="formularioCrear.get('nombre')?.invalid && formularioCrear.get('nombre')?.touched">
            El nombre es requerido
          </div>
        </div>
        <div class="form-group">
          <label>Apellido</label>
          <input type="text" formControlName="apellido" placeholder="Apellido" class="form-input">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Correo <span class="required">*</span></label>
          <input type="email" formControlName="correo" placeholder="correo@ejemplo.com" class="form-input">
          <div class="error-message" *ngIf="formularioCrear.get('correo')?.invalid && formularioCrear.get('correo')?.touched">
            Correo requerido y v√°lido
          </div>
        </div>
        <div class="form-group">
          <label>Tel√©fono</label>
          <input type="tel" formControlName="telefono" placeholder="+51 999 999 999" class="form-input">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Contrase√±a <span class="required">*</span></label>
          <input type="password" formControlName="contrasena" placeholder="M√≠nimo 6 caracteres" class="form-input">
          <div class="error-message" *ngIf="formularioCrear.get('contrasena')?.invalid && formularioCrear.get('contrasena')?.touched">
            Contrase√±a requerida (m√≠nimo 6 caracteres)
          </div>
        </div>
        <div class="form-group">
          <label>Especialidad</label>
          <input type="text" formControlName="especialidad" placeholder="Ej: Cortes cl√°sicos, Barbas" class="form-input">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>A√±os de Experiencia</label>
          <input type="number" formControlName="anosExperiencia" min="0" class="form-input">
        </div>
        <div class="form-group">
          <label>Fecha de Inicio</label>
          <input type="date" formControlName="fechaInicioTrabajo" class="form-input">
        </div>
      </div>

      <div class="form-group full-width">
        <label>Biograf√≠a</label>
        <textarea formControlName="biografia" rows="3" placeholder="Breve descripci√≥n..." class="form-input"></textarea>
      </div>

      <div class="error-message" *ngIf="erroresCrear['general']">
        {{ erroresCrear['general'] }}
      </div>

      <div class="form-actions">
        <button type="submit" class="btn btn-success" [disabled]="cargando || formularioCrear.invalid">
          {{ cargando ? 'Creando...' : 'Crear Barbero' }}
        </button>
        <button type="button" class="btn btn-secondary" (click)="cancelarCrear()">
          Cancelar
        </button>
      </div>
    </form>
  </div>

  <!-- Loading State -->
  <div *ngIf="cargando && staff.length === 0 && !mostrarFormularioCrear" class="loading">
    <div class="spinner"></div>
    <p>Cargando personal...</p>
  </div>

  <!-- Empty State -->
  <div *ngIf="!cargando && staff.length === 0 && !mostrarFormularioCrear" class="empty-state">
    <div class="empty-icon">üë•</div>
    <h3>No hay barberos registrados</h3>
    <p>Agrega barberos para que puedan atender en tu barber√≠a</p>
    <button class="btn btn-primary" (click)="toggleFormularioCrear()">
      Agregar Primer Barbero
    </button>
  </div>

  <!-- Staff List -->
  <div *ngIf="!cargando && staff.length > 0" class="staff-list">
    <div *ngFor="let miembro of staff" class="staff-card">
      <!-- Card Header -->
      <div class="card-header">
        <div class="member-info">
          <h3>{{ miembro.usuario.nombre }} {{ miembro.usuario.apellido }}</h3>
          <p>{{ miembro.usuario.correo }}</p>
          <span [class]="'badge ' + getRolBadgeClass(miembro.rol)">{{ miembro.rol }}</span>
        </div>
        <div class="card-actions">
          <button 
            class="action-btn edit" 
            (click)="editarPermisos(miembro)"
            [disabled]="editandoId === miembro.idPermiso"
            title="Editar permisos"
          >
            ‚úé Permisos
          </button>
          <button 
            class="action-btn delete" 
            (click)="eliminarStaff(miembro.usuario.idUsuario)"
            title="Eliminar staff"
          >
            üóëÔ∏è Eliminar
          </button>
        </div>
      </div>

      <!-- Permissions Form (when editing this member) -->
      <div *ngIf="editandoId === miembro.idPermiso" class="permissions-form">
        <form [formGroup]="formularioPermisos" class="form">
          <div class="form-row">
            <div class="form-group">
              <label>Rol</label>
              <select formControlName="rol" class="form-select">
                <option *ngFor="let rol of roles" [value]="rol">{{ rol }}</option>
              </select>
            </div>
          </div>

          <div class="permissions-grid">
            <div class="permission-item">
              <input type="checkbox" formControlName="puedeEditarServicios" id="editarServicios">
              <label for="editarServicios">Editar Servicios</label>
            </div>
            <div class="permission-item">
              <input type="checkbox" formControlName="puedeGestionarCitas" id="gestionarCitas">
              <label for="gestionarCitas">Gestionar Citas</label>
            </div>
            <div class="permission-item">
              <input type="checkbox" formControlName="puedeVerReportes" id="verReportes">
              <label for="verReportes">Ver Reportes</label>
            </div>
            <div class="permission-item">
              <input type="checkbox" formControlName="puedeGestionarBarberos" id="gestionarBarberos">
              <label for="gestionarBarberos">Gestionar Barberos</label>
            </div>
          </div>

          <div class="form-actions">
            <button 
              type="button" 
              class="btn btn-success" 
              (click)="guardarPermisos(miembro.usuario.idUsuario)"
              [disabled]="cargando || formularioPermisos.invalid"
            >
              Guardar Permisos
            </button>
            <button 
              type="button" 
              class="btn btn-secondary" 
              (click)="cancelarEdicion()"
            >
              Cancelar
            </button>
          </div>

          <div *ngIf="errores['general']" class="alert-error">
            {{ errores['general'] }}
          </div>
        </form>
      </div>

      <!-- Permissions Display (when not editing) -->
      <div *ngIf="editandoId !== miembro.idPermiso" class="permissions-display">
        <div class="permission-badge" [class.active]="miembro.puedeEditarServicios">
          Editar Servicios
        </div>
        <div class="permission-badge" [class.active]="miembro.puedeGestionarCitas">
          Gestionar Citas
        </div>
        <div class="permission-badge" [class.active]="miembro.puedeVerReportes">
          Ver Reportes
        </div>
        <div class="permission-badge" [class.active]="miembro.puedeGestionarBarberos">
          Gestionar Barberos
        </div>
      </div>
    </div>
  </div>
</div>
