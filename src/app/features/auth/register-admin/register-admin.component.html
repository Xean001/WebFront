<div class="auth-container">
  <div class="admin-banner">
    <div class="banner-icon">üè¢</div>
    <div class="banner-content">
      <h2>Registro de Administrador de Barber√≠a</h2>
      <p>Completa este formulario para crear tu cuenta como administrador y poder gestionar tu barber√≠a.</p>
    </div>
  </div>

  <!-- Progress Indicator -->
  <div class="progress-container">
    <div class="progress-steps">
      <div class="step-wrapper">
        <div class="step" [class.active]="paso === 1" [class.completed]="paso > 1">
          <span class="step-number">1</span>
        </div>
        <div class="step-label">Datos<br>Personales</div>
      </div>
      
      <div class="step-connector" [class.active]="paso > 1"></div>
      
      <div class="step-wrapper">
        <div class="step" [class.active]="paso === 2" [class.completed]="paso > 2">
          <span class="step-number">2</span>
        </div>
        <div class="step-label">Seleccionar<br>Plan</div>
      </div>
    </div>
  </div>

  <!-- PASO 1: Formulario de Datos Personales -->
  <div *ngIf="paso === 1" class="form-section">
    <h3>Paso 1: Tu Informaci√≥n</h3>
    
    <form [formGroup]="formulario">
      <div class="form-group">
        <label for="nombre">Nombre:</label>
        <input 
          id="nombre" 
          type="text" 
          formControlName="nombre" 
          placeholder="Tu nombre"
        >
        <div *ngIf="formulario.get('nombre')?.invalid && formulario.get('nombre')?.touched" class="error-message">
          <span *ngIf="formulario.get('nombre')?.errors?.['required']">El nombre es obligatorio.</span>
          <span *ngIf="formulario.get('nombre')?.errors?.['minlength']">M√≠nimo 2 caracteres.</span>
        </div>
      </div>

      <div class="form-group">
        <label for="apellido">Apellido:</label>
        <input 
          id="apellido" 
          type="text" 
          formControlName="apellido" 
          placeholder="Tu apellido"
        >
        <div *ngIf="formulario.get('apellido')?.invalid && formulario.get('apellido')?.touched" class="error-message">
          <span *ngIf="formulario.get('apellido')?.errors?.['required']">El apellido es obligatorio.</span>
          <span *ngIf="formulario.get('apellido')?.errors?.['minlength']">M√≠nimo 2 caracteres.</span>
        </div>
      </div>

      <div class="form-group">
        <label for="correo">Correo Electr√≥nico:</label>
        <input 
          id="correo" 
          type="email" 
          formControlName="correo" 
          placeholder="tu@email.com"
        >
        <div *ngIf="formulario.get('correo')?.invalid && formulario.get('correo')?.touched" class="error-message">
          <span *ngIf="formulario.get('correo')?.errors?.['required']">El correo es obligatorio.</span>
          <span *ngIf="formulario.get('correo')?.errors?.['email']">Formato de correo inv√°lido.</span>
        </div>
      </div>

      <div class="form-group">
        <label for="telefono">Tel√©fono:</label>
        <input 
          id="telefono" 
          type="tel" 
          formControlName="telefono" 
          placeholder="1234567890"
        >
        <div *ngIf="formulario.get('telefono')?.invalid && formulario.get('telefono')?.touched" class="error-message">
          <span *ngIf="formulario.get('telefono')?.errors?.['required']">El tel√©fono es obligatorio.</span>
          <span *ngIf="formulario.get('telefono')?.errors?.['pattern']">Formato de tel√©fono inv√°lido.</span>
        </div>
      </div>

      <div class="form-group">
        <label for="fechaNacimiento">Fecha de Nacimiento:</label>
        <input 
          id="fechaNacimiento" 
          type="date" 
          formControlName="fechaNacimiento"
        >
        <div *ngIf="formulario.get('fechaNacimiento')?.invalid && formulario.get('fechaNacimiento')?.touched" class="error-message">
          <span *ngIf="formulario.get('fechaNacimiento')?.errors?.['required']">La fecha de nacimiento es obligatoria.</span>
        </div>
      </div>

      <div class="form-group">
        <label for="genero">G√©nero:</label>
        <select class="form-input" id="genero" formControlName="genero">
          <option *ngFor="let genero of generosDisponibles" [value]="genero">
            {{ genero }}
          </option>
        </select>
      </div>

      <div class="form-group">
        <label for="contrasena">Contrase√±a:</label>
        <input 
          id="contrasena" 
          type="password" 
          formControlName="contrasena" 
          placeholder="M√≠nimo 8 caracteres"
        >
        <div *ngIf="formulario.get('contrasena')?.invalid && formulario.get('contrasena')?.touched" class="error-message">
          <span *ngIf="formulario.get('contrasena')?.errors?.['required']">La contrase√±a es obligatoria.</span>
          <span *ngIf="formulario.get('contrasena')?.errors?.['minlength']">M√≠nimo 8 caracteres.</span>
        </div>
      </div>

      <div class="form-group">
        <label for="confirmarContrasena">Confirmar Contrase√±a:</label>
        <input 
          id="confirmarContrasena" 
          type="password" 
          formControlName="confirmarContrasena" 
          placeholder="Repite tu contrase√±a"
        >
        <div *ngIf="formulario.get('confirmarContrasena')?.invalid && formulario.get('confirmarContrasena')?.touched" class="error-message">
          <span *ngIf="formulario.get('confirmarContrasena')?.errors?.['required']">Confirmar la contrase√±a es obligatorio.</span>
        </div>
        <div *ngIf="formulario.hasError('contrase√±asNoCoinciden') && formulario.get('confirmarContrasena')?.touched" class="error-message">
          Las contrase√±as no coinciden.
        </div>
      </div>

      <div *ngIf="errores['general']" class="alert-error">{{ errores['general'] }}</div>

      <button type="button" (click)="siguientePaso()" [disabled]="formulario.invalid" class="btn-primary">
        Siguiente: Seleccionar Plan ‚Üí
      </button>
    </form>
  </div>

  <!-- PASO 2: Seleccionar Plan -->
  <div *ngIf="paso === 2" class="form-section">
    <!-- Mensaje especial si ya est√° autenticado -->
    <div *ngIf="yaAutenticado" class="info-banner">
      <div class="info-icon">üë§</div>
      <div class="info-content">
        <h4>¬°Hola, {{ usuarioActual?.nombre }}!</h4>
        <p>Ya tienes una cuenta. Selecciona un nuevo plan para cambiar tu suscripci√≥n.</p>
      </div>
    </div>

    <h3>{{ yaAutenticado ? 'Cambiar Plan de Suscripci√≥n' : 'Paso 2: Elige tu Plan de Suscripci√≥n' }}</h3>
    
    <div *ngIf="planesLoading" class="loading-message">
      Cargando planes de suscripci√≥n...
    </div>

    <div *ngIf="!planesLoading && planes.length === 0" class="error-message">
      No hay planes disponibles. Por favor, intenta m√°s tarde.
    </div>

    <div *ngIf="!planesLoading" class="planes-selector">
      <div 
        *ngFor="let plan of planes" 
        class="plan-option"
        [class.selected]="planSeleccionado?.idPlan === plan.idPlan"
        (click)="seleccionarPlan(plan)"
      >
        <div class="plan-header">
          <h4>{{ plan.nombre }}</h4>
          <span class="plan-type">{{ plan.tipoPlan }}</span>
        </div>
        <div class="plan-price">
          <span class="price">${{ plan.precio | number: '1.2-2' }}</span>
          <span class="duration">/{{ plan.duracionDias }} d√≠as</span>
        </div>
        <p class="plan-description">{{ plan.descripcion }}</p>
        <div class="plan-features">
          <div class="feature">üë• {{ plan.limiteBarberos }} barberos</div>
          <div class="feature">‚úÇÔ∏è {{ plan.limiteServicios === null ? '‚àû servicios' : plan.limiteServicios + ' servicios' }}</div>
        </div>
        <div class="plan-indicator" [class.is-selected]="planSeleccionado?.idPlan === plan.idPlan">
          <span *ngIf="planSeleccionado?.idPlan === plan.idPlan">‚úì Seleccionado</span>
          <span *ngIf="planSeleccionado?.idPlan !== plan.idPlan">Seleccionar</span>
        </div>
      </div>
    </div>

    <div *ngIf="errores['plan']" class="alert-error">{{ errores['plan'] }}</div>

    <div class="button-group">
      <button type="button" (click)="pasoAnterior()" class="btn-secondary">
        <span *ngIf="!yaAutenticado">‚Üê Anterior</span>
        <span *ngIf="yaAutenticado">‚úï Cancelar</span>
      </button>
      <button type="button" (click)="registrar()" [disabled]="cargando || !planSeleccionado" class="btn-primary">
        <span *ngIf="!cargando && !yaAutenticado">Registrarse y Continuar</span>
        <span *ngIf="!cargando && yaAutenticado">Continuar con {{ planSeleccionado?.nombre }}</span>
        <span *ngIf="cargando">Procesando...</span>
      </button>
    </div>
  </div>

  <div *ngIf="!yaAutenticado" class="links">
    <a routerLink="/auth/login">¬øYa tienes cuenta? Inicia Sesi√≥n</a>
  </div>
</div>
