<div class="detail-container">
  <!-- Loading State -->
  <div *ngIf="cargando" class="detail-content">
    <div class="loading-state">
      <div class="spinner"></div>
      <p class="loading-text">Cargando informaci√≥n de la barber√≠a...</p>
    </div>
  </div>

  <!-- Main Content -->
  <div *ngIf="!cargando && barberia" class="detail-content">
    <!-- Bot√≥n de edici√≥n para propietarios -->
    <div *ngIf="esPropietario && !modoEdicion" class="edit-button-container">
      <button class="btn-edit-images" (click)="activarModoEdicion()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" style="width: 20px; height: 20px;">
          <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
          <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
        </svg>
        Editar Im√°genes
      </button>
    </div>

    <!-- Modo Edici√≥n -->
    <div *ngIf="modoEdicion" class="edit-images-panel">
      <h2 style="color: #fff; margin-bottom: 1.5rem;">Editar Im√°genes de la Barber√≠a</h2>
      
      <div class="edit-images-grid">
        <!-- Foto de Portada -->
        <div class="edit-image-section">
          <h3 style="color: #d4af37; margin-bottom: 1rem;">Foto de Portada</h3>
          <div class="image-upload-container">
            <div class="image-preview" *ngIf="imagenPortadaPreview || barberia.fotoPortadaUrl">
              <img [src]="imagenPortadaPreview || obtenerUrlImagen()" alt="Preview Portada">
              <button class="btn-remove-image" (click)="eliminarImagenPortada()" *ngIf="imagenPortadaPreview">
                ‚úï
              </button>
            </div>
            <div class="upload-placeholder" *ngIf="!imagenPortadaPreview && !barberia.fotoPortadaUrl">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                <circle cx="8.5" cy="8.5" r="1.5"></circle>
                <polyline points="21 15 16 10 5 21"></polyline>
              </svg>
              <p>Sin imagen de portada</p>
            </div>
            <input type="file" #imagenPortadaInput id="imagenPortadaInput" accept="image/*" 
                   (change)="onFilePortadaSelected($event)" style="display: none;">
            <button class="btn-upload" (click)="imagenPortadaInput.click()">
              Seleccionar Portada
            </button>
          </div>
        </div>

        <!-- Logo -->
        <div class="edit-image-section">
          <h3 style="color: #d4af37; margin-bottom: 1rem;">Logo</h3>
          <div class="image-upload-container">
            <div class="image-preview logo-preview" *ngIf="imagenLogoPreview || barberia.logoUrl">
              <img [src]="imagenLogoPreview || obtenerUrlLogo()" alt="Preview Logo">
              <button class="btn-remove-image" (click)="eliminarImagenLogo()" *ngIf="imagenLogoPreview">
                ‚úï
              </button>
            </div>
            <div class="upload-placeholder" *ngIf="!imagenLogoPreview && !barberia.logoUrl">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                <circle cx="8.5" cy="8.5" r="1.5"></circle>
                <polyline points="21 15 16 10 5 21"></polyline>
              </svg>
              <p>Sin logo</p>
            </div>
            <input type="file" #imagenLogoInput id="imagenLogoInput" accept="image/*" 
                   (change)="onFileLogoSelected($event)" style="display: none;">
            <button class="btn-upload" (click)="imagenLogoInput.click()">
              Seleccionar Logo
            </button>
          </div>
        </div>
      </div>

      <div class="edit-actions">
        <button class="btn-cancel" (click)="cancelarEdicion()">Cancelar</button>
        <button class="btn-save" (click)="guardarImagenes()">Guardar Cambios</button>
      </div>
    </div>

    <!-- Hero Banner -->
    <div class="hero-banner">
      <img [src]="obtenerUrlImagen()" [alt]="barberia.nombre" (error)="onImageError($event)">
      <div class="hero-overlay">
        <h1 class="hero-title">{{ barberia.nombre }}</h1>
        <p class="hero-subtitle">{{ barberia.ciudad }}</p>
      </div>
    </div>

    <!-- Content Grid -->
    <div class="content-grid">
      <!-- Main Content -->
      <div>
        <!-- About -->
        <div class="detail-card">
          <h2 class="card-title">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z" />
              <polyline points="13 2 13 9 20 9" />
            </svg>
            Sobre nosotros
          </h2>
          <p style="color: #b0b0b0; line-height: 1.6;">{{ barberia.descripcion }}</p>
        </div>

        <!-- Contact Info -->
        <div class="detail-card">
          <h2 class="card-title">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z" />
              <circle cx="12" cy="10" r="3" />
            </svg>
            Informaci√≥n de contacto
          </h2>
          <div class="contact-grid">
            <div class="contact-item">
              <span class="contact-label">üìû Tel√©fono</span>
              <a href="tel:" class="contact-value">{{ barberia.telefono }}</a>
            </div>
            <div class="contact-item">
              <span class="contact-label">üìß Email</span>
              <a href="mailto:" class="contact-value">{{ barberia.email }}</a>
            </div>
            <div class="contact-item full-width">
              <span class="contact-label">üìç Direcci√≥n</span>
              <p class="contact-value">{{ barberia.direccion }}</p>
            </div>
            <div class="contact-item">
              <span class="contact-label">üïê Horario</span>
              <p class="contact-value">{{ barberia.horarioApertura }} - {{ barberia.horarioCierre }}</p>
            </div>
          </div>
        </div>

        <!-- Services -->
        <div class="detail-card">
          <h2 class="card-title">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path d="M6 9h12M6 9l1.5-5.5h9l1.5 5.5M6 9v9a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V9M10 14v2M14 14v2" />
            </svg>
            Servicios Disponibles
          </h2>

          <div *ngIf="servicios.length === 0" class="no-services">
            <p>No hay servicios disponibles en este momento</p>
          </div>

          <div class="services-grid" *ngIf="servicios.length > 0">
            <div class="service-card" *ngFor="let servicio of servicios">
              <h4 class="service-name">{{ servicio.nombre }}</h4>
              <p class="service-description">{{ servicio.descripcion }}</p>
              <div class="service-footer">
                <span class="service-price">${{ servicio.precio }}</span>
                <span class="service-duration">‚è±Ô∏è {{ servicio.duracion }} min</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Sidebar -->
      <div class="sidebar">
        <!-- Rating Card -->
        <div class="rating-card">
          <h3 class="card-title" style="margin-bottom: 0;">
            <svg viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" />
            </svg>
          </h3>
          <div class="rating-stars">
            <span class="star">‚≠ê</span>
            <span class="star">‚≠ê</span>
            <span class="star">‚≠ê</span>
            <span class="star">‚≠ê</span>
            <span class="star">‚≠ê</span>
          </div>
          <p class="rating-value">{{ barberia.calificacion | number:'1.1-1' }}</p>
          <p class="rating-reviews">{{ barberia.puntuacion }} opiniones</p>

          <!-- Indicador de Favorito -->
          <div *ngIf="esFavorito"
            style="margin-top: 1rem; padding: 0.5rem; background: rgba(239, 68, 68, 0.1); border-radius: 8px; text-align: center;">
            <span style="color: #ef4444; font-size: 0.9rem;">‚ù§Ô∏è En tus favoritos</span>
          </div>
        </div>

        <!-- Barbers Card -->
        <div class="barbers-card">
          <h3 class="barbers-title">üë® Barberos</h3>

          <div *ngIf="barberos.length === 0" class="no-barbers">
            <p>No hay barberos disponibles</p>
          </div>

          <div *ngFor="let barbero of barberos" class="barber-item">
            <img [src]="barbero.usuario?.fotoUrl || 'assets/images/default-avatar.jpg'"
              alt="{{ barbero.usuario?.nombre || 'Barbero' }}" class="barber-image">
            <div class=" barber-info">
              <p class="barber-name">{{ barbero.usuario?.nombre }} {{ barbero.usuario?.apellido }}</p>
              <p class="barber-specialty" *ngIf="barbero.especialidad">{{ barbero.especialidad }}</p>
              <div class="barber-rating" *ngIf="barbero.valoracionPromedio && barbero.valoracionPromedio > 0">
                <span>‚≠ê</span>
                <span>{{ barbero.valoracionPromedio | number:'1.1-1' }}</span>
                <span class="barber-reviews">({{ barbero.totalValoraciones }} opiniones)</span>
              </div>
              <span class="barber-citas" *ngIf="barbero.totalServiciosCompletados">
                {{ barbero.totalServiciosCompletados }} servicios completados
              </span>
            </div>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="button-group">
          <button class="btn-reserve" (click)="irAReservar()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" style="width: 20px; height: 20px;">
              <rect x="3" y="4" width="18" height="18" rx="2" ry="2" />
              <line x1="16" y1="2" x2="16" y2="6" />
              <line x1="8" y1="2" x2="8" y2="6" />
              <line x1="3" y1="10" x2="21" y2="10" />
            </svg>
            Reservar Cita
          </button>
          <button class="btn-favorite" [class.is-favorite]="esFavorito" [disabled]="cargandoFavorito"
            (click)="toggleFavorito()">
            <svg viewBox="0 0 24 24" [attr.fill]="esFavorito ? 'currentColor' : 'none'" stroke="currentColor"
              style="width: 20px; height: 20px;">
              <path
                d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z" />
            </svg>
            <span *ngIf="!cargandoFavorito">{{ esFavorito ? 'Eliminar de Favoritos' : 'Agregar a Favoritos' }}</span>
            <span *ngIf="cargandoFavorito">Procesando...</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Valoraciones Section -->
    <div class="content-grid" style="margin-top: 2rem;">
      <div class="detail-card">
        <h2 class="card-title">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" />
          </svg>
          Valoraciones de Clientes
        </h2>

        <div *ngIf="valoraciones.length === 0" class="no-reviews">
          <p style="color: #b0b0b0; text-align: center; padding: 2rem 0;">
            A√∫n no hay valoraciones. ¬°S√© el primero en dejar tu opini√≥n!
          </p>
        </div>

        <div class="reviews-list" *ngIf="valoraciones.length > 0">
          <div class="review-card" *ngFor="let valoracion of valoraciones">
            <div class="review-header">
              <div class="review-user-info">
                <img [src]="valoracion.clienteFotoUrl || 'assets/images/default-avatar.jpg'" alt="Cliente"
                  class="review-avatar">
                <div>
                  <p class="review-user-name">{{ valoracion.clienteNombre }} {{ valoracion.clienteApellido }}</p>
                  <div class="review-stars">
                    <span *ngFor="let star of [1,2,3,4,5]" [class.filled]="star <= valoracion.puntuacionGeneral"
                      class="review-star">‚≠ê</span>
                  </div>
                </div>
              </div>
              <span class="review-date">{{ valoracion.fechaCreacion | date:'dd/MM/yyyy' }}</span>
            </div>

            <p class="review-comment" *ngIf="valoracion.comentario">{{ valoracion.comentario }}</p>

            <div class="review-response" *ngIf="valoracion.respuestaBarberia">
              <div class="response-header">
                <strong>Respuesta de {{ barberia.nombre }}:</strong>
              </div>
              <p>{{ valoracion.respuestaBarberia }}</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>